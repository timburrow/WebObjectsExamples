<html>
<title>Release Notes for Derby 10.3.2.1</title>
<body>
<h1>
<a name="Release Notes for Derby 10.3.2.1"></a>Release Notes for Derby 10.3.2.1</h1>
<blockquote>
<p>These notes describe the difference between Derby release 10.3.2.1 and the preceding release 10.3.1.4.</p>
</blockquote>
<ul>
<li>
<a href="#Overview">Overview</a>
</li>
<li>
<a href="#New Features">New Features</a>
</li>
<li>
<a href="#Bug Fixes">Bug Fixes</a>
</li>
<li>
<a href="#Issues">Issues</a>
</li>
<li>
<a href="#Build Environment">Build Environment</a>
</li>
</ul>
<h2>
<a name="Overview"></a>Overview</h2>
<blockquote>


<p>
Derby is a pure Java relational database engine using standard SQL and
JDBC as its APIs.
</p>


<p>
Derby functionality includes:
</p>


<ul>

<li>Embedded engine with JDBC drivers</li>

<li>Network Server</li>

<li>Network client JDBC drivers</li>

<li>Command line tools: ij (SQL scripting), dblook (schema dump) and sysinfo (system info)</li>

</ul>


</blockquote>
<h2>
<a name="New Features"></a>New Features</h2>
<blockquote>


<p>
This is a maintenance release. No new features have been added.
</p>


</blockquote>
<h2>
<a name="Bug Fixes"></a>Bug Fixes</h2>
<blockquote>
<p>The following issues are addressed by Derby release 10.3.2.1. These issues are not addressed in the preceding 10.3.1.4 release.</p>
<table border="2">
<tr>
<td><b>Issue Id</b></td><td><b>Description</b></td>
</tr>
<tr>
<td><a href="http://issues.apache.org/jira/browse/DERBY-3232">DERBY-3232</a></td><td>Top-level index.html in releases incorrectly indicates support for JDBC 2.1 in 10.3 releases</td>
</tr>
<tr>
<td><a href="http://issues.apache.org/jira/browse/DERBY-3216">DERBY-3216</a></td><td>do row level lock space reclamation in btree of indiv rows.</td>
</tr>
<tr>
<td><a href="http://issues.apache.org/jira/browse/DERBY-3190">DERBY-3190</a></td><td>New simple demo suitable for supported Java ME platforms</td>
</tr>
<tr>
<td><a href="http://issues.apache.org/jira/browse/DERBY-3187">DERBY-3187</a></td><td>SimpleApp (demo) does not work in a client setting</td>
</tr>
<tr>
<td><a href="http://issues.apache.org/jira/browse/DERBY-3176">DERBY-3176</a></td><td>J2ME support for phoneME platform disabled in 10.3</td>
</tr>
<tr>
<td><a href="http://issues.apache.org/jira/browse/DERBY-3175">DERBY-3175</a></td><td>NullPointerException on INSERT after ALTER TABLE ... DROP COLUMN</td>
</tr>
<tr>
<td><a href="http://issues.apache.org/jira/browse/DERBY-3172">DERBY-3172</a></td><td>ConnectionEventListener.connectionErrorOccurred not being executed when SQLState 08006 Error is thrown</td>
</tr>
<tr>
<td><a href="http://issues.apache.org/jira/browse/DERBY-3159">DERBY-3159</a></td><td>SYSCS_SET_USER_ACCESS fails if the user name contains characters not allowed in regular identifiers. </td>
</tr>
<tr>
<td><a href="http://issues.apache.org/jira/browse/DERBY-3158">DERBY-3158</a></td><td>Repeat calls to SYSCS_UTIL.SYSCS_SET_USER_ACCESS() for the same user and permission fail with repeated user in list exception.</td>
</tr>
<tr>
<td><a href="http://issues.apache.org/jira/browse/DERBY-3147">DERBY-3147</a></td><td>Remove unused code that allow identifiers to be lower-cased.</td>
</tr>
<tr>
<td><a href="http://issues.apache.org/jira/browse/DERBY-3142">DERBY-3142</a></td><td>sysinfo ignores derby.ui.locale</td>
</tr>
<tr>
<td><a href="http://issues.apache.org/jira/browse/DERBY-3136">DERBY-3136</a></td><td>Cut down on object creations in LIKE clause implementation of territory based characters.</td>
</tr>
<tr>
<td><a href="http://issues.apache.org/jira/browse/DERBY-3133">DERBY-3133</a></td><td>Syntax for GRANT table permission does not mention that several privileges may be specified in a list</td>
</tr>
<tr>
<td><a href="http://issues.apache.org/jira/browse/DERBY-3126">DERBY-3126</a></td><td>Inserting BigDecimal value in PreparedStatement with setBigDecimal into double column loses fractional digits</td>
</tr>
<tr>
<td><a href="http://issues.apache.org/jira/browse/DERBY-3123">DERBY-3123</a></td><td>Style sheet (CSS) references in demo HTML files are incorrect</td>
</tr>
<tr>
<td><a href="http://issues.apache.org/jira/browse/DERBY-3119">DERBY-3119</a></td><td>Derby does not resolve functions to methods with Integer return type.</td>
</tr>
<tr>
<td><a href="http://issues.apache.org/jira/browse/DERBY-3118">DERBY-3118</a></td><td>Simple demo is out of date</td>
</tr>
<tr>
<td><a href="http://issues.apache.org/jira/browse/DERBY-3110">DERBY-3110</a></td><td>server hangs after trace on command fails</td>
</tr>
<tr>
<td><a href="http://issues.apache.org/jira/browse/DERBY-3109">DERBY-3109</a></td><td>Nonexistent property derby.database.defaultAccessMode shown in Developers Guide: User Authentication examples</td>
</tr>
<tr>
<td><a href="http://issues.apache.org/jira/browse/DERBY-3107">DERBY-3107</a></td><td>On client, Clob.free() does not release locators.</td>
</tr>
<tr>
<td><a href="http://issues.apache.org/jira/browse/DERBY-3099">DERBY-3099</a></td><td>Possible bug in interaction with buffer manager causing pages not to be freed on rollback to savepoint</td>
</tr>
<tr>
<td><a href="http://issues.apache.org/jira/browse/DERBY-3098">DERBY-3098</a></td><td>LOB locks are not released after free().</td>
</tr>
<tr>
<td><a href="http://issues.apache.org/jira/browse/DERBY-3096">DERBY-3096</a></td><td>SSL handshake throws "bad_certificate" when server tries to authenticate client</td>
</tr>
<tr>
<td><a href="http://issues.apache.org/jira/browse/DERBY-3093">DERBY-3093</a></td><td>Intermittent transaction failure caused by internal duplicate savepoint name for triggers</td>
</tr>
<tr>
<td><a href="http://issues.apache.org/jira/browse/DERBY-3086">DERBY-3086</a></td><td>The server policy needs to grant derbynet.jar more permissions so that sysinfo and drda tracing will work</td>
</tr>
<tr>
<td><a href="http://issues.apache.org/jira/browse/DERBY-3085">DERBY-3085</a></td><td>Fails to handle BLOB fields with a PreparedStatement with size &gt;32750 bytes</td>
</tr>
<tr>
<td><a href="http://issues.apache.org/jira/browse/DERBY-3081">DERBY-3081</a></td><td>cannot create instance of generated class because of java.lang.VerifyError in 4 tests on IBM iseries</td>
</tr>
<tr>
<td><a href="http://issues.apache.org/jira/browse/DERBY-3080">DERBY-3080</a></td><td>With TERRITORY_BASED collation, when multiple characters map to a single collation element '_'  matches a single collation element rather than a single character</td>
</tr>
<tr>
<td><a href="http://issues.apache.org/jira/browse/DERBY-3077">DERBY-3077</a></td><td>Trying to reconnect with derby client after bringing server down throws SQL Exception 58009 rather than 08XXX exception</td>
</tr>
<tr>
<td><a href="http://issues.apache.org/jira/browse/DERBY-3075">DERBY-3075</a></td><td>Client error: 08001 Error connecting to server.. throws SQLTransientConnectionException instead of SQLNonTransientConnectionException</td>
</tr>
<tr>
<td><a href="http://issues.apache.org/jira/browse/DERBY-3074">DERBY-3074</a></td><td>Database shutdown exception 08006 throws SQLTransientConnectionException instead of SQLNonTransientConnectionException</td>
</tr>
<tr>
<td><a href="http://issues.apache.org/jira/browse/DERBY-3061">DERBY-3061</a></td><td>Wrong results from query with two conjuncts</td>
</tr>
<tr>
<td><a href="http://issues.apache.org/jira/browse/DERBY-3046">DERBY-3046</a></td><td>setObj(int,Object,int) causes NPE if no parameter markers are present; should generate SQLException as for setObject(int,Object)</td>
</tr>
<tr>
<td><a href="http://issues.apache.org/jira/browse/DERBY-3038">DERBY-3038</a></td><td>SYSCS_IMPORT_TABLE FAILS  with No current connection after shutdown/reconnect to encrypted database : 10.3.1.4 regression </td>
</tr>
<tr>
<td><a href="http://issues.apache.org/jira/browse/DERBY-3033">DERBY-3033</a></td><td>select query results in nullpointer exception in skipScan()</td>
</tr>
<tr>
<td><a href="http://issues.apache.org/jira/browse/DERBY-3032">DERBY-3032</a></td><td>java.lang.ClassCastException returning null from a case statement  in subquery</td>
</tr>
<tr>
<td><a href="http://issues.apache.org/jira/browse/DERBY-3025">DERBY-3025</a></td><td>NPE when connecting to database with securityMechanism=8</td>
</tr>
<tr>
<td><a href="http://issues.apache.org/jira/browse/DERBY-3007">DERBY-3007</a></td><td>Documentation - SYSCS EXPORT TABLE system procedures cannot export data to an existing file</td>
</tr>
<tr>
<td><a href="http://issues.apache.org/jira/browse/DERBY-3000">DERBY-3000</a></td><td>getTables() call with 10.3 causes java.sql.SQLException: The parameter position '8' is out of range.  The number of parameters for this prepared  statement is '7'.</td>
</tr>
<tr>
<td><a href="http://issues.apache.org/jira/browse/DERBY-2989">DERBY-2989</a></td><td>Insert into table with constraints fails if the table name is "indicator" (or any other SQL keyword)</td>
</tr>
<tr>
<td><a href="http://issues.apache.org/jira/browse/DERBY-2986">DERBY-2986</a></td><td>Query involving CASE statement significantly slower in 10.3.1.4 than in 10.2.2.0</td>
</tr>
<tr>
<td><a href="http://issues.apache.org/jira/browse/DERBY-2972">DERBY-2972</a></td><td>Update or select with function in the where clause causes with TERRITORY_BASED collation fails with ERROR 42818: Comparisons between 'VARCHAR' and 'VARCHAR' are not supported.</td>
</tr>
<tr>
<td><a href="http://issues.apache.org/jira/browse/DERBY-2967">DERBY-2967</a></td><td>Single character does not match high value unicode character with collation TERRITORY_BASED</td>
</tr>
<tr>
<td><a href="http://issues.apache.org/jira/browse/DERBY-2961">DERBY-2961</a></td><td>TriggerTest.testTypesINActionStatement fails with 'ASSERT FAILED col1.getClass() (class org.apache.derby.iapi.types.SQLClob) expected to be the same as col2.getClass() (class org.apache.derby.iapi.types.CollatorSQLClob)</td>
</tr>
<tr>
<td><a href="http://issues.apache.org/jira/browse/DERBY-2957">DERBY-2957</a></td><td>ASSERT FAILED col1.getClass() (class org.apache.derby.iapi.types.SQLChar) expected to be the same as col2.getClass() (class org.apache.derby.iapi.types.CollatorSQLChar) in NistScripts dml002 test with collated database</td>
</tr>
<tr>
<td><a href="http://issues.apache.org/jira/browse/DERBY-2910">DERBY-2910</a></td><td>SimpleStringOperatorNode in it's bindExpression method generates a character string CAST if required but does not set the correct collation.</td>
</tr>
<tr>
<td><a href="http://issues.apache.org/jira/browse/DERBY-2906">DERBY-2906</a></td><td>derbynet.jar &amp; derbytools.jar incorrectly have a META-INF/services/java.sql.Driver entry</td>
</tr>
<tr>
<td><a href="http://issues.apache.org/jira/browse/DERBY-2902">DERBY-2902</a></td><td>AS IDENTITY (START WITH -9223372036854775808) fails</td>
</tr>
<tr>
<td><a href="http://issues.apache.org/jira/browse/DERBY-2564">DERBY-2564</a></td><td>ContextService.notifyAllActiveThreads()  and network server code need a privileged block around the calls to Thread.interrupt()</td>
</tr>
<tr>
<td><a href="http://issues.apache.org/jira/browse/DERBY-2352">DERBY-2352</a></td><td>Assertion Failure with order by and group by expression</td>
</tr>
<tr>
<td><a href="http://issues.apache.org/jira/browse/DERBY-2351">DERBY-2351</a></td><td>ORDER BY with expression with distinct in the select list returns incorrect result</td>
</tr>
<tr>
<td><a href="http://issues.apache.org/jira/browse/DERBY-2297">DERBY-2297</a></td><td>In the Dev Guide example derby.database.readOnlyAccessUsers is incorrectly mentioned as derby.database.readAccessUsers </td>
</tr>
<tr>
<td><a href="http://issues.apache.org/jira/browse/DERBY-2188">DERBY-2188</a></td><td>Developer's Guide talks about a jdbc url property "locale" which is not supported by Derby.</td>
</tr>
<tr>
<td><a href="http://issues.apache.org/jira/browse/DERBY-2073">DERBY-2073</a></td><td>Inserting BigDecimal value in PreparedStatement into double column loses fractional digits</td>
</tr>
<tr>
<td><a href="http://issues.apache.org/jira/browse/DERBY-2016">DERBY-2016</a></td><td>ArrayIndexOutOfBoundsException for COALESCE with aggregate functions</td>
</tr>
<tr>
<td><a href="http://issues.apache.org/jira/browse/DERBY-1790">DERBY-1790</a></td><td>DatabaseMetaData.getTables() with passed in table type of SYNONYM returns system tables and not SYNONYMS</td>
</tr>
<tr>
<td><a href="http://issues.apache.org/jira/browse/DERBY-1769">DERBY-1769</a></td><td>Add mention that Derby supports rowUpdated, rowDeleted with a result set concurrency of  CONCUR_READ_ONLY</td>
</tr>
<tr>
<td><a href="http://issues.apache.org/jira/browse/DERBY-974">DERBY-974</a></td><td>ClientDriver can lose some connection properties</td>
</tr>
<tr>
<td><a href="http://issues.apache.org/jira/browse/DERBY-857">DERBY-857</a></td><td>LDAP user authentication fails under a security manager</td>
</tr>
</table>
</blockquote>
<h2>
<a name="Issues"></a>Issues</h2>
<blockquote>
<p>Compared with the previous release (10.3.1.4), Derby release 10.3.2.1 introduces the following new features and incompatibilities. These merit your special attention.</p>
<ul>
<li>
<a href="#Note for DERBY-2967">
<p>Note for DERBY-2967: 
  Databases with territory based collation might see the behavior of LIKE predicate in WHERE clause has changed. 
</p>
</a>
</li>
</ul>
<hr>
<h3>
<a name="Note for DERBY-2967"></a>Note for DERBY-2967</h3>
<blockquote>


<h4>Summary of Change</h4>

<p>
  Databases with territory based collation might see the behavior of LIKE predicate in WHERE clause has changed. 
</p>


<h4>Symptoms Seen by Applications Affected by Change</h4>

<p>
In territory based databases, the LIKE predicate will now comply with SQL specification(Derby already follows SQL specification for UCS_BASIC databases). SQL specification for LIKE predicate requires that database should do one character comparison at a time. Prior to the fix that went in as part of DERBY-2967, Derby did string comparison rather than character comparison for LIKE. This causes a problem with territory based database because the collation element(s) for a string of characters may not be same as the collation element(s) for inidivdual characters that make up that string. 
In addition, the metacharacter _ in the pattern in a LIKE predicate will now consume exactly one character rather than working on number of collation elements.
To show the impact on application, consider following eg. Say we are working with a territory where character 'z' has same collation elements as 'xy'. For such a territory consider following LIKE predicate 
'zcb' LIKE 'xy_b' 
Prior to DERBY-2967, Derby will return TRUE because collation elements for 'z' matched 'xy' and 'c' was consumed by '_' and 'b' matched 'b'. But this does not follow SQL specification. SQL specification requires one character comparison at a time in LIKE. With the fix for DERBY-2967, the LIKE predicate in this example will return FALSE because the collation element(s) for 'z' does not match collation element(s) for 'x'. 
In addition, the metacharacter _ in pattern for LIKE will consume *one* character in the string value. So for an eg clause 'xycb' LIKE '_cb' will return FALSE because metacharacter _ will consume 'x' and since 'c' does not match 'y', Derby will return FALSE.
</p>



<h4>Rationale for Change</h4>

<p>
The previous behavior violated the SQL specification. The new behavior is correct.
</p>



</blockquote>
</blockquote>
<h2>
<a name="Build Environment"></a>Build Environment</h2>
<blockquote>
<p>Derby release 10.3.2.1 was built using the following environment:</p>
<ul>
<li>
<b>Branch</b> - Source code came from the 10.3 branch.</li>
<li>
<b>Machine</b> - MKS Toolkit 8.1 on Microsoft Windows XP Professional Version 2002 Service Pack 2.</li>
<li>
<b>Ant</b> - Apache Ant version 1.7.0  compiled on December 13 2006.</li>
<li>
<b>JDK 1.4</b> - Java(TM) 2 Runtime Environment, Standard Edition (build 1.4.2_07-b05)</li>
<li>
<b>Java 6</b> -  Java(TM) SE Runtime Environment (build 1.6.0_01-b06).</li>
<li>
<b>OSGi</b> - The osgi.jar was used to build org.apache.derby.osgi.EmbeddedActivator.</li>
<li>
<b>Compiler</b> - The 1.4.2_07-b05 javac was used to compile all classes
           except for the JDBC4 drivers. The JDBC4 driver classes were compiled using the 1.6.0_01-b06 javac.</li>
<li>
<b>JSR 169</b> - Java ME support was built using Java ME CDC/Foundation Specification 1.1 libraries from IBM WebSphere Everyplace Micro Environment 6.1  </li>
</ul>
</blockquote>
</body>
</html>
